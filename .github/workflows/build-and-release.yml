name: Build LaTeX and Update Release

on:
  push:
    branches: [ main ]

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup TeX Live
        uses: xu-cheng/latex-action@v3
        with:
          latexmk_use_xelatex: true  # or false if using pdflatex
          latexmk_shell_escape: false
      
      - name: Build PDF
        working-directory: ./build
        run: |
          make -B stat205.pdf
          ls -la  # Verify PDF was created
      
      # Verify PDF exists before release
      - name: Check PDF exists
        run: |
          if [ ! -f build/stat205.pdf ]; then
            echo "::error::PDF was not generated!"
            exit 1
          fi
      
      # Create/update release
      - name: Update Release
        uses: softprops/action-gh-release@v1
        with:
          files: build/stat205.pdf
          tag_name: "latest"
          name: "Latest Book Version"
          body: "Automatically generated - ${{ github.sha }}"
          replace_assets: true
          draft: false
